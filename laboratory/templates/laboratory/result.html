{% extends '_base.html' %}
{% load i18n %}
{% load humanize %}
{% load static %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% block content %}
<div class="container-lg py-5 my-5">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-6">
            <div class="white-glass shadow-lg rounded-4 p-4 p-md-5" style="direction: rtl;">

                <!-- کادر زرد دقیقاً مثل عکس ادمین -->
                <div class="text-center mb-4">
                    <div class="d-inline-block w-100 bg-warning text-white py-4 rounded-4 shadow-lg"
                         style="background: linear-gradient(90deg, #fcc419 0%, #fcc419 100%);
                                font-weight: bold;
                                font-size: 2.2rem;
                                letter-spacing: 1px;">
                        مشاهده نتیجه آزمایش
                    </div>
                </div>

                <!-- متن توضیحی زیر کادر -->
                <p class="text-center lead text-muted mb-5">
                    برای مشاهده نتیجه آزمایش کد پیامکی ارسال شده را در کادر وارد کنید
                </p>

                <!-- فرم جستجو -->
                <form method="post" class="mb-5"> 
                    {% csrf_token %}
                    {{ form | crispy }}
                    <div class="text-center">
                        <button type="submit" class="btn btn-gold btn-lg px-5">
                            نمایش نتیجه
                        </button>
                    </div>
                </form>

                <!-- نمایش نتیجه -->
                {% if result %}
                    <div class="text-center">
                        <h3 class="mb-4">نتیجه شما:</h3>

                        {% if download_url %}
                            <a href="{{ download_url }}" download class="btn btn-gold btn-lg px-5 py-3 text-decoration-none">
                                <i class="fas fa-file-download me-2"></i>
                                دانلود فایل PDF نتیجه آزمایش
                            </a>
                        {% else %}
                            <div class="rounded-3 overflow-hidden shadow">
                                <img src="{{ result.file.url }}" alt="نتیجه آزمایش" class="img-fluid">
                            </div>
                        {% endif %}
                    </div>
                {% endif %}

                <!-- نمایش خطا -->
                {% if error %}
                    <div class="alert alert-danger text-center mt-4">
                        <strong>{{ error }}</strong>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}